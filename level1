import spacy
nlp = spacy.load("en_core_web_sm")

#preprocessing:-after dividing into sentences, divide into tokens
sent = "James is playing football in the stadium in morning"
doc = nlp(sent)
def dep_conversion():
    global subj,aux_verb,root_verb,obj,sent_list #need to remove globals
    #subj,aux_verb,root_verb,obj,sent_list = [],[],[],[],[] #dep lists #note:replace variables with lists or dictionary for advanced nlp tasks 
    subj,aux_verb,root_verb,obj,sent_list = [],[],[],[],[]
    for token in doc:
      sent_list.append(token)
      if ((token.dep_  in ["nsubjpass",'csubjpass','nsubj','csubj']) and (not subj)) :
        subj = token.text
      elif (token.dep_ in ["ROOT","root"] and (not root_verb)):
        root_verb = token.text
      elif ((token.dep_ not in ["auxpass","AUX","MD","BES"]) and (not aux_verb)):
        aux_verb = token.text
      elif ((token.dep_ not in ["dobj",'iobj','oprd','obj',"pobj"]) and (not obj)):
        obj = token.text
  
#without coref and ent 
def check_dep_conversion(dep_list):
    for item in sent_list:
      if item in dep_list:
        print("who")
      else:
        print(item)
    print("---")

#with ent not coref
def ent_conversion():
    global ent_label_list,ent_text_list
    ent_label_list,ent_text_list=[],[]
    for entities in doc.ents:
        #print(f"{entities.text:<25} {entities.label_:<15} {spacy.explain(entities.label_)}")
        ent_text_list.append(entities)
        ent_label_list.append(entities.label_)

"""if item in entity list is present in subj/verb/obj,
          then assign appropriate wh-question"""
dep_conversion()
ent_conversion()

def check_ent_dep():
  print("the items present in both entity list and subj/verb/obj lists are:")
  for item in ent_text_list:
    if item.text==subj or obj or root_verb or aux_verb:
      print(item,item.label_)
      
check_ent_dep()
def question(wh,name):
  question=[]
  for item1 in sent_list:
    #dict/df/list/class attributes/df+ML_model
    if item1.text==name.text:
      question.append(wh)
    else:
      question.append(item1.text)
  print("\n",*question,"?",end=" ")
for item in ent_text_list:
  if item.label_ in {"TIME" , "DATE"}:
    question("when",item)
  if item.label_ in {"PERSON" , "NORP"}:
    question("who",item)
  if item.label_ in {"FACILITY" , "FAC","GPE",'LOC',"GPE","GPE_LOC"}:
    question("where",item)
  if item.label_ in {"PRODUCT" , "EVENT","WORK_OF_ART","LAW","LANGUAGE","PROD","GPE_ORG"}:
    question("what",item)

"""insert other L1 question words like 'list','match','tell' etc here"""
"""insert coref code here"""
